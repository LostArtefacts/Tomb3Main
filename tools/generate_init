#!/usr/bin/env python3
import io
import json
from pathlib import Path

import pyjson5

REPO_DIR = Path(__file__).parent.parent.absolute()
BIN_DIR = REPO_DIR / "bin"
SRC_DIR = REPO_DIR / "src"
CONFIG_DIR = BIN_DIR / "cfg"


BODY = """
// THIS IS AN AUTOGENERATED FILE.
// To generate it, run tools/generate_init.

#ifndef VERSION
    #define VERSION "T3M (unknown version)"
#endif

const char *g_T3MVersion = VERSION;
"""


def main() -> None:
    with io.StringIO() as handle:
        print(BODY.strip(), file=handle)
        new_text = handle.getvalue()

    path = SRC_DIR / "init.c"
    if not path.exists () or path.read_text() != new_text:
        path.write_text(new_text)


if __name__ == "__main__":
    main()
